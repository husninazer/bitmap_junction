import QtQuick 2.11
import QtQuick.Controls 2.2

import Device 0.1

Page {

property bool deviceState: device.state

    Device {
        id: device
    }

//    Canvas {
//        id: mycanvas

//        width: parent.width
//        height: 1000
//        onPaint: {


//            var data = "1111111111111111111111111111111111111111111111100000001111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000011111100011111111100000111111111100111111111111110111111111111111111110111100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000111111111111111111111111111111111111111111111111111111111111111111111111111000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000011000000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000001100000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000110000000000001111111111111111111100011111111100000011111111011111111111100001111100001110000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000011111111111111000000000000000000000000000000000000000000001100000000000000000000000000000000000011111000010000000111110000000000000000000000000000000000000000110000000000000000000000000000000001111000000001000000000001111000000000000000000000000000000000000011000000000000000000000000000000011100000000000100000000000000111000000000000000000000000000000000001100000000000000000000000000000011000000000000010000000000000000110000000000000000000000000000000000110000000000000000000000000000011000000000000001000000000000000001100000000000000000000000000000000011000000000000000000000000000011000000000000000100000000000000000011000000000000000000000000000000001100000000000000000000000000011000000000000000010000000000000000000110000000000000000000000000000000110000000000000000000000000001000000000000000001000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000011000000000000000000000000000110000000000000000100000000000000000001100000000000000000000000000000001100000000000000000000000000001100000000000000010000000000000000001100000000000000000000000000000000110000000000000000000000000000011000000000000001000000000000000001100000000000000000000000000000000011000000000000000000000000000000110000000000000100000000000000001100000000000000000000000000000000001100000000000000000000000000000001110000000000010000000000000011100000000000000000000000000000000000110000000000000000000000000000000001111000000001000000000001111000000000000000000000000000000000000011000000000000000000000000000000000000111110000100000001111100000000000000000000000000000000000000001100000000000000000000000000000000000000001111111111111100000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000011111100011111111100000111111111100111111111111110111111111111111111110111100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000111111111111111111111111111111111111111111111111111111111111111111111111111000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001000000000000010000000000001000000000000010000000000001000000000010000000010000000000001100000000000100000000000001000000000000100000000000001000000000000100000000001000000001000000000000110000000000010000000000000100000000000010000000000000100000000000010000000000100000000100000000000011000000000001111111111111111111100011111111100000011111111011111111111100001111100001110000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
//            console.log("SIZE",data.length)
//            var ctx = getContext("2d");
//            ctx.beginPath();
//            var count = 0;
//            y = 0
//            for(var x=0; x<10000; x++) {

//                    count++;
//                    if(count > 99){
//                        count =0;
//                        y++;
//                    }
//                    else{
//                        count++;
//                    }

//                    if(data[x] === "1"){
//                        console.log("ONES", data[x])

//                        ctx.moveTo(x,y)
//                        ctx.lineTo(x+20,y)
//                        ctx.strokeStyle="#000000";
//                        ctx.stroke();
//                    }
//                    else{
//                        console.log("ZEROS", data[x])
//                        ctx.moveTo(x,y)
//                        ctx.lineTo(x,y)
//                        ctx.strokeStyle="#FFFFFF";
//                        ctx.stroke();

//                    }

//            }
//        }
//    }


Image {
    id: imageMap
    //source: "qrc:/icons/map.jpeg"
    source: "qrc:/icons/last.bmp"
    width: height = parent.width

    Timer {
        id: timeDevice
        interval: 500; running: true; repeat: true
        onTriggered: {
            device.startDeviceDiscovery();
             //if startDeviceDiscovery() failed device.state is not set
            if (device.state) {
                deviceBusy.visible = true
               // info.visible = true;
            }
        }
    }

    Component.onCompleted: {
          timeDevice.start()
    }

    Rectangle {
        id: bubble
        width: height = 18
        color: 'red'
        radius: 9

        Component.onCompleted: {
            blink.start()
        }

        PropertyAnimation {
            id: blink
            property: 'opacity'; duration: 200; target: bubble
            from: 0; to: 1; loops: Animation.Infinite
        }

        //source: "content/Bluebubble.svg"
        smooth: true
        property real centerX: parent.width / 2
        property real centerY: parent.height / 2
        property real bubbleCenter: bubble.width / 2
        x: centerX - bubbleCenter
        y: centerY - bubbleCenter

        Behavior on y {
            SmoothedAnimation {
                easing.type: Easing.Linear
                duration: 100
            }
        }
        Behavior on x {
            SmoothedAnimation {
                easing.type: Easing.Linear
                duration: 100
            }
        }
    }
}

ListView {
    id: theListView
    width: parent.width

    clip: true

    anchors.top: imageMap.bottom
    anchors.bottom: parent.bottom
    model: device.devicesList

    BusyIndicator {
        id: deviceBusy
        anchors.centerIn: parent
        visible: false
    }

    delegate: Rectangle {
        id: box
        height:100
        width: parent.width
        color: "lightsteelblue"
        border.width: 2
        border.color: "darkgrey"
        radius: 5

        Component.onCompleted: {
            deviceBusy.visible = false
            //info.visible = false;
            //header.headerText = "Select a device";
        }

        MouseArea {
            anchors.fill: parent
//            onClicked: {
//                device.scanServices(modelData.deviceAddress);
//                pageLoader.source = "Services.qml"
//            }
        }

        Label {
            id: deviceName
            text: modelData.deviceRssi
            anchors.top: parent.top
            anchors.topMargin: 5
        }

        Label {
            id: deviceAddress
            text: modelData.deviceAddress
            font.pointSize: deviceName.font.pointSize*0.7
            anchors.bottom: box.bottom
            anchors.bottomMargin: 5
        }


    }
}

}
